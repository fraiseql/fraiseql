{
  "types": [
    {
      "name": "Order",
      "fields": [
        {
          "name": "id",
          "type": "ID",
          "nullable": false
        },
        {
          "name": "customer_email",
          "type": "String",
          "nullable": false
        },
        {
          "name": "status",
          "type": "String",
          "nullable": false
        },
        {
          "name": "total",
          "type": "Float",
          "nullable": false
        },
        {
          "name": "created_at",
          "type": "DateTime",
          "nullable": false
        }
      ],
      "description": "E-commerce order."
    },
    {
      "name": "Payment",
      "fields": [
        {
          "name": "id",
          "type": "ID",
          "nullable": false
        },
        {
          "name": "order_id",
          "type": "ID",
          "nullable": false
        },
        {
          "name": "amount",
          "type": "Float",
          "nullable": false
        },
        {
          "name": "status",
          "type": "String",
          "nullable": false
        },
        {
          "name": "processed_at",
          "type": "DateTime",
          "nullable": true
        }
      ],
      "description": "Payment record."
    }
  ],
  "enums": [],
  "input_types": [],
  "interfaces": [],
  "unions": [],
  "queries": [],
  "mutations": [],
  "subscriptions": [],
  "observers": [
    {
      "name": "on_high_value_order",
      "entity": "Order",
      "event": "INSERT",
      "actions": [
        {
          "type": "webhook",
          "headers": {
            "Content-Type": "application/json"
          },
          "url": "https://api.example.com/high-value-orders"
        },
        {
          "type": "slack",
          "channel": "#sales",
          "message": "üéâ High-value order {id}: ${total}",
          "webhook_url_env": "SLACK_WEBHOOK_URL"
        },
        {
          "type": "email",
          "to": "sales@example.com",
          "subject": "High-value order {id}",
          "body": "Order {id} for ${total} was created by {customer_email}"
        }
      ],
      "condition": "total > 1000",
      "retry": {
        "max_attempts": 3,
        "backoff_strategy": "exponential",
        "initial_delay_ms": 100,
        "max_delay_ms": 60000
      }
    },
    {
      "name": "on_order_shipped",
      "entity": "Order",
      "event": "UPDATE",
      "actions": [
        {
          "type": "webhook",
          "headers": {
            "Content-Type": "application/json"
          },
          "url_env": "SHIPPING_WEBHOOK_URL"
        },
        {
          "type": "email",
          "to": "{customer_email}",
          "subject": "Your order {id} has shipped!",
          "body": "Your order is on its way. Track it here: https://example.com/track/{id}",
          "from": "noreply@example.com"
        }
      ],
      "condition": "status.changed() and status == 'shipped'",
      "retry": {
        "max_attempts": 3,
        "backoff_strategy": "exponential",
        "initial_delay_ms": 100,
        "max_delay_ms": 60000
      }
    },
    {
      "name": "on_payment_failure",
      "entity": "Payment",
      "event": "UPDATE",
      "actions": [
        {
          "type": "slack",
          "channel": "#payments",
          "message": "‚ö†Ô∏è Payment failed for order {order_id}: {amount}",
          "webhook_url_env": "SLACK_WEBHOOK_URL"
        },
        {
          "type": "webhook",
          "headers": {
            "Authorization": "Bearer {PAYMENT_API_TOKEN}"
          },
          "url": "https://api.example.com/payment-failures"
        }
      ],
      "condition": "status == 'failed'",
      "retry": {
        "max_attempts": 5,
        "backoff_strategy": "exponential",
        "initial_delay_ms": 100,
        "max_delay_ms": 60000
      }
    },
    {
      "name": "on_order_deleted",
      "entity": "Order",
      "event": "DELETE",
      "actions": [
        {
          "type": "webhook",
          "headers": {
            "Content-Type": "application/json"
          },
          "url": "https://api.example.com/archive",
          "body_template": "{\"type\": \"order\", \"id\": \"{{id}}\", \"data\": {{_json}}}"
        }
      ],
      "condition": null,
      "retry": {
        "max_attempts": 3,
        "backoff_strategy": "exponential",
        "initial_delay_ms": 100,
        "max_delay_ms": 60000
      }
    },
    {
      "name": "on_order_created",
      "entity": "Order",
      "event": "INSERT",
      "actions": [
        {
          "type": "slack",
          "channel": "#orders",
          "message": "New order {id} by {customer_email}",
          "webhook_url_env": "SLACK_WEBHOOK_URL"
        }
      ],
      "condition": null,
      "retry": {
        "max_attempts": 3,
        "backoff_strategy": "exponential",
        "initial_delay_ms": 100,
        "max_delay_ms": 60000
      }
    }
  ]
}
