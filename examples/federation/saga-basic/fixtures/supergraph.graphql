schema
  @link(url: "https://specs.apollo.dev/federation/v2.0")
{
  query: Query
  mutation: Mutation
}

directive @federation__field(requires: String, provides: String, external: Boolean, shareable: Boolean) repeatable on FIELD_DEFINITION
directive @federation__interface(key: String, shareable: Boolean) repeatable on INTERFACE
directive @federation__object(key: String, shareable: Boolean) repeatable on OBJECT
directive @federation__union(join__possibleTypes: [String]) on UNION
directive @federation__enumValue(join__graph: String) repeatable on ENUM_VALUE
directive @federation__enum(join__possibleValues: [federation__enumValue]) on ENUM
directive @federation__scalar(join__specifiedByUrl: String) on SCALAR
directive @federation__argument(join__type: String) on ARGUMENT_DEFINITION
directive @join__field(graph: String, requires: String, provides: String, type: String, external: Boolean, override: String, usedOverridden: Boolean) repeatable on FIELD_DEFINITION
directive @join__type(graph: String, key: String, extension: Boolean, resolvable: Boolean, isInterfaceObject: Boolean) repeatable on OBJECT | INTERFACE | UNION | ENUM | SCALAR | INPUT_OBJECT
directive @join__union(graph: String, member: String) repeatable on UNION
directive @join__enumValue(graph: String) repeatable on ENUM_VALUE
directive @join__implements(graph: String, interface: String) repeatable on OBJECT | INTERFACE
directive @join__graph(name: String!, url: String!) on ENUM_VALUE
directive @link(url: String, as: String, for: String, import: [String]) repeatable on SCHEMA

type Query {
  user(id: ID!): User @join__field(graph: USERS)
  users: [User!]! @join__field(graph: USERS)
  order(id: ID!): Order @join__field(graph: ORDERS)
  ordersByUser(userId: ID!): [Order!]! @join__field(graph: ORDERS)
  product(id: ID!): Product @join__field(graph: INVENTORY)
  reservation(id: ID!): Reservation @join__field(graph: INVENTORY)
}

type Mutation {
  verifyUserExists(userId: ID!): User! @join__field(graph: USERS)
  createOrder(userId: ID!, items: [OrderItemInput!]!, chargeId: String!, reservationId: String!): Order! @join__field(graph: ORDERS)
  cancelOrder(orderId: ID!): Order! @join__field(graph: ORDERS)
  reserveItems(items: [ReservationItemInput!]!, orderId: ID!): Reservation! @join__field(graph: INVENTORY)
  releaseReservation(reservationId: ID!): Reservation! @join__field(graph: INVENTORY)
}

type User @join__type(graph: USERS, key: "id") {
  id: ID!
  name: String!
  email: String!
  createdAt: String!
}

type Order @join__type(graph: ORDERS, key: "id") {
  id: ID!
  userId: ID!
  status: String!
  total: Float!
  items: [OrderItem!]!
  createdAt: String!
}

type OrderItem @join__type(graph: ORDERS) {
  productId: ID!
  quantity: Int!
  price: Float!
}

type Product @join__type(graph: INVENTORY, key: "id") {
  id: ID!
  name: String!
  stock: Int!
  price: Float!
}

type Reservation @join__type(graph: INVENTORY, key: "id") {
  id: ID!
  orderId: ID!
  items: [ReservationItem!]!
  status: String!
  createdAt: String!
}

type ReservationItem @join__type(graph: INVENTORY) {
  productId: ID!
  quantity: Int!
}

input OrderItemInput {
  productId: ID!
  quantity: Int!
  price: Float!
}

input ReservationItemInput {
  productId: ID!
  quantity: Int!
}

enum join__Graph {
  USERS @join__graph(name: "users" url: "http://users-service:4000/graphql")
  ORDERS @join__graph(name: "orders" url: "http://orders-service:4000/graphql")
  INVENTORY @join__graph(name: "inventory" url: "http://inventory-service:4000/graphql")
}
