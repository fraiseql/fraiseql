{
  "types": [
    {
      "name": "Order",
      "fields": []
    },
    {
      "name": "Payment",
      "fields": []
    }
  ],
  "queries": [],
  "mutations": [],
  "subscriptions": [],
  "observers": [
    {
      "name": {
        "kind": "method",
        "name": "onHighValueOrder",
        "metadata": {},
        "static": false,
        "private": false,
        "access": {}
      },
      "entity": "Order",
      "event": "INSERT",
      "actions": [
        {
          "type": "webhook",
          "headers": {
            "Content-Type": "application/json"
          },
          "url": "https://api.example.com/high-value-orders"
        },
        {
          "type": "slack",
          "channel": "#sales",
          "message": "üéâ High-value order {id}: ${total}",
          "webhook_url_env": "SLACK_WEBHOOK_URL"
        },
        {
          "type": "email",
          "to": "sales@example.com",
          "subject": "High-value order {id}",
          "body": "Order {id} for ${total} was created by {customer_email}"
        }
      ],
      "condition": "total > 1000",
      "retry": {
        "max_attempts": 3,
        "backoff_strategy": "exponential",
        "initial_delay_ms": 100,
        "max_delay_ms": 60000
      }
    },
    {
      "name": {
        "kind": "method",
        "name": "onOrderShipped",
        "metadata": {},
        "static": false,
        "private": false,
        "access": {}
      },
      "entity": "Order",
      "event": "UPDATE",
      "actions": [
        {
          "type": "webhook",
          "headers": {
            "Content-Type": "application/json"
          },
          "url_env": "SHIPPING_WEBHOOK_URL"
        },
        {
          "type": "email",
          "to": "{customer_email}",
          "subject": "Your order {id} has shipped!",
          "body": "Your order is on its way. Track it here: https://example.com/track/{id}",
          "from": "noreply@example.com"
        }
      ],
      "condition": "status.changed() and status == 'shipped'",
      "retry": {
        "max_attempts": 3,
        "backoff_strategy": "exponential",
        "initial_delay_ms": 100,
        "max_delay_ms": 60000
      }
    },
    {
      "name": {
        "kind": "method",
        "name": "onOrderCreated",
        "metadata": {},
        "static": false,
        "private": false,
        "access": {}
      },
      "entity": "Order",
      "event": "INSERT",
      "actions": [
        {
          "type": "slack",
          "channel": "#orders",
          "message": "New order {id} by {customer_email}",
          "webhook_url_env": "SLACK_WEBHOOK_URL"
        }
      ],
      "retry": {
        "max_attempts": 3,
        "backoff_strategy": "exponential",
        "initial_delay_ms": 100,
        "max_delay_ms": 60000
      }
    },
    {
      "name": {
        "kind": "method",
        "name": "onOrderDeleted",
        "metadata": {},
        "static": false,
        "private": false,
        "access": {}
      },
      "entity": "Order",
      "event": "DELETE",
      "actions": [
        {
          "type": "webhook",
          "headers": {
            "Content-Type": "application/json"
          },
          "url": "https://api.example.com/archive",
          "body_template": "{\"type\": \"order\", \"id\": \"{{id}}\", \"data\": {{_json}}}"
        }
      ],
      "retry": {
        "max_attempts": 3,
        "backoff_strategy": "exponential",
        "initial_delay_ms": 100,
        "max_delay_ms": 60000
      }
    },
    {
      "name": {
        "kind": "method",
        "name": "onPaymentFailure",
        "metadata": {},
        "static": false,
        "private": false,
        "access": {}
      },
      "entity": "Payment",
      "event": "UPDATE",
      "actions": [
        {
          "type": "slack",
          "channel": "#payments",
          "message": "‚ö†Ô∏è Payment failed for order {order_id}: {amount}",
          "webhook_url_env": "SLACK_WEBHOOK_URL"
        },
        {
          "type": "webhook",
          "headers": {
            "Authorization": "Bearer {PAYMENT_API_TOKEN}"
          },
          "url": "https://api.example.com/payment-failures"
        }
      ],
      "condition": "status == 'failed'",
      "retry": {
        "max_attempts": 5,
        "backoff_strategy": "exponential",
        "initial_delay_ms": 100,
        "max_delay_ms": 60000
      }
    }
  ]
}
