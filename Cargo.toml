# FraiseQL v2 - Compiled GraphQL Execution Engine
# Workspace root configuration

[profile.bench]
lto = "thin"
opt-level = 3

[profile.dev]
debug = true
opt-level = 0

[profile.release]
codegen-units = 1
lto = "fat"
opt-level = 3
strip = true

[profile.test]
opt-level = 1

[workspace]
members = [
  "crates/fraiseql-arrow",  # Apache Arrow Flight integration (Phase 9)
  "crates/fraiseql-cli",
  "crates/fraiseql-core",
  "crates/fraiseql-error",
  "crates/fraiseql-observers",
  "crates/fraiseql-observers-macros",  # Procedural macros for automatic instrumentation (Phase 9.2.B)
  "crates/fraiseql-server",  # HTTP server with runtime, webhooks, files (Phases 1-4B)
  "crates/fraiseql-wire"  # Streaming JSON query engine for Postgres
]
resolver = "2"

[workspace.dependencies]
# Encryption
aes-gcm = "0.10"
anyhow = "1.0"
async-trait = "0.1"
# HTTP server (Axum)
axum = {version = "0.7"}
# Encoding
base64 = "0.22"
# Utilities
bytes = "1.0"
# Time
chrono = {version = "0.4", features = ["serde"]}
dashmap = "6.0"
# Connection pooling
deadpool = "0.12"
deadpool-postgres = "0.14"
# Internal crates
fraiseql-wire = {path = "crates/fraiseql-wire", version = "0.1.1"}
futures = "0.3"
# GraphQL parsing
graphql-parser = "0.4"
hex = "0.4"
hmac = "0.12"
hyper = {version = "1.0"}
itertools = "0.13"
jsonwebtoken = "9.2"
lazy_static = "1.4"
linked-hash-map = "0.5"
# Caching
lru = "0.16"
# TLS
native-tls = "0.2"
once_cell = "1.19"
# Parking lot (faster mutexes)
parking_lot = "0.12"
postgres-native-tls = "0.5"
# Python FFI (for fraiseql-python crate)
pyo3 = {version = "0.25", features = ["extension-module", "experimental-async"]}
pyo3-async-runtimes = {version = "0.25", features = ["tokio-runtime"]}
# Random
rand = "0.8"
# Kafka
rdkafka = {version = "0.36", features = ["tokio"]}
regex = "1.10"
# HTTP client
reqwest = {version = "0.12", features = ["json"]}
# SQLite
rusqlite = {version = "0.32", features = ["bundled"]}
# Serialization
serde = {version = "1.0", features = ["derive"]}
serde_json = "1.0"
# Crypto
sha2 = "0.10"
# MySQL
sqlx = {version = "0.8", features = ["mysql", "runtime-tokio", "json"]}
# Testing utilities
tempfile = "3.8"
# Error handling
thiserror = "2.0"
# Async runtime
tokio = {version = "1.0", features = ["full"]}
# Database drivers
# PostgreSQL
tokio-postgres = {version = "0.7", features = ["with-serde_json-1", "with-uuid-1", "with-chrono-0_4"]}
tokio-util = {version = "0.7"}
# Configuration
toml = "0.8"
tower = {version = "0.5"}
tower-http = {version = "0.5", features = ["cors", "compression-gzip"]}
# Logging
tracing = "0.1"
tracing-subscriber = {version = "0.3", features = ["env-filter"]}
# UUID
uuid = {version = "1.0", features = ["v4", "serde"]}

[workspace.lints.clippy]
# Deny all warnings in CI (priority -1 lets individual lints override)
all = {level = "deny", priority = -1}
cargo = {level = "warn", priority = -1}  # Changed to warn - metadata errors not blocking
cargo_common_metadata = "allow"  # Internal crates don't need all metadata
if_not_else = "allow"  # Style preference
missing_errors_doc = "allow"  # Can be too verbose
missing_panics_doc = "allow"  # Can be too verbose
module_name_repetitions = "allow"
multiple_crate_versions = "allow"  # Transitive dependencies cause this
must_use_candidate = "allow"  # We'll use this selectively
nursery = {level = "warn", priority = -1}  # Nursery is experimental, keep as warn
option_if_let_else = "allow"  # Style preference
or_fun_call = "allow"  # Often clearer to keep explicit
pedantic = {level = "warn", priority = -1}  # Changed to warn - too many false positives
redundant_closure_for_method_calls = "allow"  # Style preference
return_self_not_must_use = "allow"  # Builder pattern compatibility
significant_drop_tightening = "allow"  # Too aggressive, false positives
similar_names = "allow"
struct_excessive_bools = "allow"  # Schema structs often have many bool flags
# Allow some pedantic lints that are too strict for practical use
too_many_lines = "allow"
# Additional allows for common pedantic/nursery lints that don't add value
uninlined_format_args = "allow"  # Style preference, too noisy
unnecessary_wraps = "allow"  # API consistency over strictness
unused_async = "allow"  # Sometimes needed for trait conformance
unused_enumerate_index = "allow"  # Sometimes index needed later
unused_self = "allow"  # Sometimes needed for API compatibility
use_self = "allow"  # Style preference

[workspace.lints.rust]
dead_code = "warn"
missing_docs = "warn"
unsafe_code = "forbid"
unused_imports = "warn"
unused_variables = "warn"

[workspace.package]
authors = ["FraiseQL Team <team@fraiseql.dev>"]
categories = ["database", "web-programming"]
documentation = "https://docs.fraiseql.dev"
edition = "2021"
homepage = "https://fraiseql.dev"
keywords = ["graphql", "database", "compiler", "sql"]
license = "MIT OR Apache-2.0"
repository = "https://github.com/fraiseql/fraiseql"
rust-version = "1.75"  # MSRV
version = "2.0.0-alpha.1"
