[[bench]]
harness = false
name = "adapter_comparison"
required-features = ["postgres"]

[[bench]]
harness = false
name = "full_pipeline_comparison"
required-features = ["postgres"]

[[bench]]
harness = false
name = "sql_projection_benchmark"

[[bench]]
harness = false
name = "federation_bench"

[dependencies]
anyhow = {workspace = true}
# Arrow Flight integration (optional)
# Note: fraiseql-arrow depends on fraiseql-core, not the other way around
# to avoid circular dependency. fraiseql-arrow provides the Flight server
# and concrete Arrow conversion implementations.
arrow = {version = "53", optional = true}
arrow-array = {version = "53", optional = true}
base64 = {workspace = true}
bb8 = {version = "0.8", optional = true}
bb8-tiberius = {version = "0.15", optional = true}
# Utilities
bytes = {workspace = true}
chrono = {workspace = true}
dashmap = {workspace = true}
deadpool = {workspace = true}
# fraiseql-wire backend (optional)
fraiseql-wire = {workspace = true, optional = true}
futures = {workspace = true}
# GraphQL
graphql-parser = {workspace = true}
hex = {workspace = true}
hmac = {workspace = true}
itertools = {workspace = true}
jsonwebtoken = {workspace = true}
lazy_static = {workspace = true}
linked-hash-map = {workspace = true}
lru = {workspace = true}
native-tls = {workspace = true}
once_cell = {workspace = true}
parking_lot = {workspace = true}
postgres-native-tls = {workspace = true}
rand = {workspace = true}
# Kafka (optional)
rdkafka = {workspace = true, optional = true}
regex = {workspace = true}
reqwest = {workspace = true}
# Workspace dependencies
serde = {workspace = true}
serde_json = {workspace = true}
sha2 = {workspace = true}
# Database - MySQL/SQLite (via sqlx)
sqlx = {version = "0.8", features = ["runtime-tokio", "json"], optional = true}
thiserror = {workspace = true}
# Database - SQL Server
tiberius = {version = "0.12", default-features = false, features = ["tds73", "rustls"], optional = true}
tokio = {workspace = true}
# Database - PostgreSQL
tokio-postgres = {workspace = true, features = ["with-serde_json-1"]}
tokio-util = "0.7"
toml = {workspace = true}
# Logging
tracing = {workspace = true}
uuid = {workspace = true}
async-trait.workspace = true
deadpool-postgres.workspace = true

[dev-dependencies]
criterion = {version = "0.5", features = ["async_tokio"]}
serial_test = "3"
tempfile = {workspace = true}
tokio-test = "0.4"

[features]
# Arrow Flight integration for high-performance analytics
# Provides arrow_executor module for Arrow RecordBatch conversion.
# For Arrow Flight server, use fraiseql-arrow crate which depends on fraiseql-core[arrow].
arrow = ["dep:arrow", "dep:arrow-array"]
default = ["postgres", "rich-filters"]
kafka = ["rdkafka"]
mysql = ["sqlx/mysql"]
postgres = []
# Rich type filters (Email, VIN, IBAN, CountryCode, etc.)
# Includes specialized filter operators for 44 rich scalar types
rich-filters = []
sqlite = ["sqlx/sqlite"]
sqlserver = ["tiberius", "bb8", "bb8-tiberius"]
# Run with: cargo test --features test-mysql -- --test-threads=1
test-mysql = ["mysql"]
# Test features - enable database integration tests
# Run with: cargo test --features test-postgres -- --test-threads=1
test-postgres = []
# Run with: cargo test --features test-sqlserver -- --test-threads=1
test-sqlserver = ["sqlserver"]
wire-backend = ["fraiseql-wire"]

[package]
description = "Core execution engine for FraiseQL v2 - Compiled GraphQL over SQL"
name = "fraiseql-core"
authors.workspace = true
categories.workspace = true
documentation.workspace = true
edition.workspace = true
homepage.workspace = true
keywords.workspace = true
license.workspace = true
repository.workspace = true
rust-version.workspace = true
version.workspace = true
