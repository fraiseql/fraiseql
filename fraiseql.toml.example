# FraiseQL v2.1.0 Configuration Template
#
# This file contains all configuration for the FraiseQL compiler and runtime.
# Copy to fraiseql.toml in your project root and customize for your environment.

[project]
name = "my-fraiseql-app"
version = "1.0.0"
description = "My secure GraphQL API"

[fraiseql]
# Input and output file paths
schema_file = "schema.json"           # Generated by Python/TypeScript decorators
output_file = "schema.compiled.json"  # Output from fraiseql-cli compile

# =============================================================================
# SECURITY CONFIGURATION
#
# All security settings are compile-time constants baked into the schema.
# Environment variables at runtime can override specific values.
# =============================================================================

# AUDIT LOGGING
# Tracks all security-relevant events for compliance and monitoring
[fraiseql.security.audit_logging]
enabled = true
log_level = "info"                    # Options: "debug", "info", "warn"
include_sensitive_data = false        # SECURITY: Never true in production!
async_logging = true                  # Use async logging for performance
buffer_size = 1000                    # Events to buffer before flushing
flush_interval_secs = 5               # Seconds between flushes

# ERROR SANITIZATION
# Prevents information leakage through error messages
[fraiseql.security.error_sanitization]
enabled = true
generic_messages = true               # SECURITY: Always true in production!
internal_logging = true               # Log full details internally
leak_sensitive_details = false        # SECURITY: Never true!
user_facing_format = "generic"        # Options: "generic", "simple", "detailed"

# RATE LIMITING
# Protects authentication endpoints from brute-force attacks
[fraiseql.security.rate_limiting]
enabled = true

# Per-IP limits (public authentication endpoints)
auth_start_max_requests = 100         # Max /auth/start requests per IP per minute
auth_start_window_secs = 60           # Time window in seconds
auth_callback_max_requests = 50       # Max /auth/callback requests per IP per minute
auth_callback_window_secs = 60        # Time window in seconds

# Per-user limits (authenticated endpoints)
auth_refresh_max_requests = 10        # Max /auth/refresh requests per user per minute
auth_refresh_window_secs = 60         # Time window in seconds
auth_logout_max_requests = 20         # Max /auth/logout requests per user per minute
auth_logout_window_secs = 60          # Time window in seconds

# Failed login attempt limiting
failed_login_max_requests = 5         # Max failed attempts before lockout
failed_login_window_secs = 3600       # 1 hour lockout window

# STATE ENCRYPTION (PKCE)
# Encrypts OAuth state parameter using ChaCha20-Poly1305 AEAD
[fraiseql.security.state_encryption]
enabled = true
algorithm = "chacha20-poly1305"       # Only supported algorithm
key_rotation_enabled = false          # Future feature
nonce_size = 12                       # Bytes: 96-bit (immutable)
key_size = 32                         # Bytes: 256-bit (immutable)
#
# IMPORTANT: The encryption key is NOT stored in this file (security risk).
# Provide at runtime via environment variable:
#   export STATE_ENCRYPTION_KEY=$(openssl rand -base64 32)

# CONSTANT-TIME COMPARISON
# Prevents timing attacks on token validation
[fraiseql.security.constant_time]
enabled = true
apply_to_jwt = true                   # JWT signature verification
apply_to_session_tokens = true        # Session token comparison
apply_to_csrf_tokens = true           # CSRF token validation
apply_to_refresh_tokens = true        # Refresh token comparison

# =============================================================================
# ENVIRONMENT VARIABLE OVERRIDES
#
# These environment variables override the TOML settings at runtime:
#
# AUDIT_LOG_LEVEL=info                    # Override log level
# RATE_LIMIT_AUTH_START=100               # Override per-IP auth start limit
# RATE_LIMIT_AUTH_CALLBACK=50             # Override per-IP auth callback limit
# RATE_LIMIT_AUTH_REFRESH=10              # Override per-user refresh limit
# RATE_LIMIT_AUTH_LOGOUT=20               # Override per-user logout limit
# RATE_LIMIT_FAILED_LOGIN=5               # Override failed login limit
# STATE_ENCRYPTION_KEY=<base64-32-bytes>  # REQUIRED for state encryption
#
# Example deployment:
#   export STATE_ENCRYPTION_KEY=$(openssl rand -base64 32)
#   export RATE_LIMIT_FAILED_LOGIN=3      # More aggressive in prod
#   ./fraiseql-server --schema schema.compiled.json
# =============================================================================

# =============================================================================
# PRESET CONFIGURATIONS
#
# Uncomment below for common deployment scenarios
# =============================================================================

# DEVELOPMENT (relaxed security for testing)
# [fraiseql.security.audit_logging]
# log_level = "debug"
# include_sensitive_data = true
# async_logging = false
#
# [fraiseql.security.error_sanitization]
# user_facing_format = "detailed"
#
# [fraiseql.security.rate_limiting]
# auth_start_max_requests = 10000
# failed_login_max_requests = 10000

# PRODUCTION (strict security)
# [fraiseql.security.audit_logging]
# log_level = "info"
# include_sensitive_data = false
#
# [fraiseql.security.error_sanitization]
# generic_messages = true
# leak_sensitive_details = false
#
# [fraiseql.security.rate_limiting]
# auth_start_max_requests = 100
# failed_login_max_requests = 5

# ENTERPRISE (maximum security)
# [fraiseql.security.audit_logging]
# log_level = "debug"
# buffer_size = 5000
# flush_interval_secs = 1
#
# [fraiseql.security.rate_limiting]
# auth_start_max_requests = 50
# failed_login_max_requests = 3
