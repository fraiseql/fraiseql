# Release Notes - FraiseQL v0.10.3

## ‚ú® IpAddressString Scalar CIDR Notation Support

### Release Date: 2025-10-06
### Type: Feature Enhancement

## Summary

This release enhances the `IpAddressString` scalar to accept CIDR notation for improved PostgreSQL INET compatibility while remaining fully backward compatible.

## üéØ Enhancement (Fixes #77)

### IpAddressString Now Accepts CIDR Notation

The `IpAddressString` scalar type now intelligently handles both plain IP addresses and CIDR notation, automatically extracting the IP address portion when CIDR is provided.

#### What's New

‚úÖ **Accepts plain IP addresses** (existing behavior)
```python
"192.168.1.1" ‚Üí IPv4Address("192.168.1.1")
"2001:db8::1" ‚Üí IPv6Address("2001:db8::1")
```

‚úÖ **Accepts CIDR notation** (new)
```python
"192.168.1.1/24" ‚Üí IPv4Address("192.168.1.1")  # /24 stripped
"10.0.0.1/8" ‚Üí IPv4Address("10.0.0.1")
"2001:db8::1/64" ‚Üí IPv6Address("2001:db8::1")
```

#### Benefits

1. **PostgreSQL INET Compatibility**: Direct compatibility with PostgreSQL's `INET` type which stores CIDR notation
2. **Backward Compatible**: Existing code using plain IP addresses continues to work
3. **Flexible Input**: Accepts both formats from GraphQL clients
4. **Automatic Stripping**: CIDR suffix is automatically removed for the IPv4Address/IPv6Address object

#### Use Cases

**1. Network Configuration Management**
```graphql
mutation {
  createNetwork(input: {
    gateway: "192.168.1.1/24"  # CIDR notation accepted
    dns: "8.8.8.8"              # Plain IP also works
  })
}
```

**2. Database Views with INET Columns**
```sql
-- PostgreSQL view returns INET with CIDR
CREATE VIEW v_network AS
SELECT
    id,
    gateway::text as gateway  -- Returns "192.168.1.1/24"
FROM networks;
```

```python
# FraiseQL type handles it automatically
@fraiseql.type
class Network:
    id: str
    gateway: IpAddressString  # Accepts "192.168.1.1/24"
```

**3. IP Range Queries**
```python
# Works with CIDR from database
networks = await repo.find("v_network")
for net in networks:
    # net.gateway is clean IPv4Address object
    print(f"Gateway: {net.gateway}")
```

## üìù Technical Details

### Implementation

The enhancement modifies the `IpAddressString` scalar's value parser:

```python
# Before (v0.10.2 and earlier)
value = IPv4Address(input_str)  # Fails on CIDR notation

# After (v0.10.3+)
if '/' in input_str:
    input_str = input_str.split('/')[0]  # Strip CIDR suffix
value = IPv4Address(input_str)  # Now works with CIDR input!
```

### Backward Compatibility

‚úÖ **100% backward compatible** - All existing code continues to work:
- Plain IP addresses: No change in behavior
- Type validation: Same strict validation
- Error handling: Same error messages for invalid IPs
- GraphQL schema: No schema changes required

### Edge Cases Handled

```python
# Valid inputs
"192.168.1.1"       ‚Üí IPv4Address("192.168.1.1")
"192.168.1.1/24"    ‚Üí IPv4Address("192.168.1.1")
"192.168.1.1/32"    ‚Üí IPv4Address("192.168.1.1")
"10.0.0.1/8"        ‚Üí IPv4Address("10.0.0.1")
"2001:db8::1/64"    ‚Üí IPv6Address("2001:db8::1")

# Invalid inputs (proper error messages)
"192.168.1.1/abc"   ‚Üí Error: Invalid IP address
"not-an-ip/24"      ‚Üí Error: Invalid IP address
"192.168.1.256/24"  ‚Üí Error: Invalid IP address
```

## üîÑ Migration Guide

### No Changes Required!

This is a **transparent enhancement**. Existing code works without modification:

```python
# Your existing code (no changes needed)
@fraiseql.type
class Server:
    ip_address: IpAddressString

# Now accepts both formats
# ‚úÖ "192.168.1.1"
# ‚úÖ "192.168.1.1/24" (new)
```

### Optional: Leverage New Capability

If you want to accept CIDR notation from clients:

```python
# Update your GraphQL input types (optional)
@fraiseql.input
class ServerInput:
    ip_address: IpAddressString  # Now accepts CIDR!
    subnet_mask: str | None = None  # Can be optional now
```

## üéâ Impact

### For Developers
- ‚úÖ Cleaner integration with PostgreSQL INET columns
- ‚úÖ Less manual string processing
- ‚úÖ More flexible GraphQL input handling
- ‚úÖ Better PostgreSQL compatibility

### For Users
- ‚úÖ Can paste IP addresses with CIDR directly from network configs
- ‚úÖ Consistent with how IPs are typically stored (with subnet info)
- ‚úÖ More intuitive API for network-related mutations

## üì¶ Installation

```bash
pip install --upgrade fraiseql==0.10.3
```

## üîó Related

- **Issue**: #77 (IpAddressString scalar should accept CIDR notation)
- **Previous Release**: [v0.10.2](RELEASE_NOTES_v0.10.2.md) - Mutation input transformation
- **Next Release**: [v0.10.4](RELEASE_NOTES_v0.10.4.md) - Documentation improvements

## üôè Credits

This enhancement was driven by real-world usage feedback from FraiseQL users working with network management systems and PostgreSQL INET types.

---

**Upgrade today to simplify your network-related GraphQL APIs!** üöÄ
