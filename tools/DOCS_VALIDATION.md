# Documentation Validation Tools

Automated tools to validate FraiseQL documentation structure, links, and formatting.

## Overview

The documentation validation suite includes:

1. **Link Validator (Python)** — Validates internal and external markdown links
2. **Link Validator (Bash)** — Alternative bash-based implementation
3. **GitHub Actions Workflow** — Automated validation on push/PR
4. **Markdown Linter** — Checks markdown formatting and structure

---

## Usage

### Python Link Validator (Recommended)

The Python validator is more robust and handles edge cases better.

#### Installation

```bash
# Python 3.8+ required (no external dependencies)
python3 --version  # Verify Python 3.8+
```

#### Running Locally

```bash
# Check current directory
python3 tools/validate-docs-links.py

# Check specific directory
python3 tools/validate-docs-links.py ./docs

# Verbose output (show all checked links)
python3 tools/validate-docs-links.py ./docs --verbose

# Also check external URLs (slower)
python3 tools/validate-docs-links.py ./docs --check-external

# Combine options
python3 tools/validate-docs-links.py ./docs -v -e
```

#### Exit Codes

- `0` — All links valid
- `1` — Broken internal links found
- `2` — No markdown files found
- `3` — Script error

#### Example Output

```
ℹ FraiseQL Documentation Link Validator
ℹ Checking documentation in: /home/user/fraiseql/docs
ℹ Found 196 markdown files

✓ Validating 196 files...

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
✓ All 196 files validated successfully!
```

### Bash Link Validator

Alternative implementation using bash (useful for CI without Python).

```bash
# Make executable
chmod +x tools/validate-docs-links.sh

# Check current directory
bash tools/validate-docs-links.sh

# Check specific directory
bash tools/validate-docs-links.sh ./docs

# Verbose output
VERBOSE=true bash tools/validate-docs-links.sh ./docs

# Check external URLs
CHECK_EXTERNAL=true bash tools/validate-docs-links.sh ./docs
```

### Using in CI/CD

#### GitHub Actions (Automatic)

The workflow `.github/workflows/docs-validation.yml` runs automatically:

- **On push** to `v2-development`, `feature/*`, or `main` branches
- **On pull request** when docs files change
- **Checks**: Link validation, markdown linting, structure validation, anchor checking

#### Manual CI Integration

```bash
#!/bin/bash
# In your CI script
python3 tools/validate-docs-links.py ./docs --verbose
exit_code=$?

if [ $exit_code -ne 0 ]; then
    echo "Documentation validation failed"
    exit 1
fi
```

---

## What Gets Validated

### Link Validation

✅ **Checks for:**

- Broken internal links (relative and absolute paths)
- Missing files referenced in markdown
- Invalid path references
- Unresolved relative paths

❌ **Won't catch:**

- Typos in link text (only path validation)
- Outdated content (semantic errors)
- Private/internal-only links

### Optional: External URL Validation

When using `--check-external`:

- Attempts HTTP HEAD request to external URLs
- Detects unreachable URLs
- Slower (adds 1-2 seconds per URL)
- Requires internet connection

### Markdown Linting

The GitHub Actions workflow also runs `markdownlint` which checks:

- MD001: Heading levels
- MD003: Heading style consistency
- MD024: Multiple headings with same content
- MD025: Multiple top-level headings
- MD026: Trailing punctuation in headings
- And 30+ other style rules

### Structure Checks

- Orphaned files (no incoming references)
- TODO/FIXME comments in docs
- Broken anchor references within files
- Documentation consistency

---

## Documentation Link Formats Supported

### Standard Markdown Links

```markdown
[Link text](./relative/path.md)
[Link text](/absolute/path.md)
[Link text](../parent/path.md)
[Link text](https://external.com)
[Link text](path.md#anchor)
```

### Reference Links

```markdown
[Link text][ref]

[ref]: ./path/to/file.md
[ref]: https://external.com
```

### Directories

```markdown
[Link text](./directory/)  # Will check for directory/README.md
```

---

## Common Issues and Fixes

### Issue: "Broken link but file exists"

**Causes:**

- Path is relative but validator checking from different directory
- File has `.md` extension but link doesn't (or vice versa)
- Symlinks not being followed

**Solution:**

```bash
# Run validator from docs root
cd docs
python3 ../tools/validate-docs-links.py .

# Or specify full path
python3 tools/validate-docs-links.py /full/path/to/docs
```

### Issue: False positives for generated links

**Causes:**

- Links generated by tooling (not resolved correctly)
- Dynamic links (template variables)

**Solution:**
Mark the line with HTML comment:

```markdown
<!-- validate-docs-links:ignore -->
[Dynamic link]({{ variable }})
```

### Issue: Slow validation with external URLs

**Causes:**

- Network requests to every external URL
- Timeouts on slow networks

**Solution:**

- Skip external validation by default (don't use `--check-external`)
- Run external checks separately on CI only:

  ```bash
  # Local: skip external
  python3 tools/validate-docs-links.py ./docs

  # CI: check external
  python3 tools/validate-docs-links.py ./docs --check-external
  ```

---

## Integration Examples

### Pre-commit Hook

```bash
#!/bin/bash
# .git/hooks/pre-commit

echo "Validating documentation links..."
python3 tools/validate-docs-links.py ./docs

if [ $? -ne 0 ]; then
    echo "❌ Documentation validation failed"
    echo "Please fix broken links before committing"
    exit 1
fi
```

### MakeFile Target

```makefile
.PHONY: validate-docs
validate-docs:
 python3 tools/validate-docs-links.py ./docs --verbose

.PHONY: validate-docs-external
validate-docs-external:
 python3 tools/validate-docs-links.py ./docs --verbose --check-external

.PHONY: ci-docs
ci-docs: validate-docs
 @echo "✓ Documentation validation passed"
```

### GitHub Actions Custom Workflow

```yaml
name: Docs Validate

on: [push, pull_request]

jobs:
  docs:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'

      - name: Validate docs links
        run: python3 tools/validate-docs-links.py ./docs --verbose
```

---

## Performance

### Validation Speed

- **196 markdown files**: ~1-2 seconds
- **Internal links only**: <1 second
- **With external URLs**: 30-60 seconds (network-dependent)

### Optimization Tips

1. Run internal validation only on local dev (`--check-external` on CI only)
2. Cache external URL checks between runs
3. Run in parallel CI jobs if checking many services
4. Use Python version over bash (faster regex matching)

---

## Maintenance

### When to Run Validation

- ✅ **Before committing** — Catch broken links early
- ✅ **On every PR** — Automated via GitHub Actions
- ✅ **Before release** — Full validation including external URLs
- ✅ **When restructuring docs** — Especially moving/renaming files

### Keeping Validators Updated

The validators handle:

- Standard markdown link syntax `[text](link)` and `[text]: link`
- Both relative and absolute paths
- Directory references (README.md lookup)
- Fragment anchors `#anchor`

If you add new link formats:

1. Update regex patterns in both validators
2. Add test cases
3. Run full validation

---

## Troubleshooting

### `ModuleNotFoundError: No module named 're'`

The `re` module is built-in to Python 3. If this error occurs:

```bash
# Reinstall Python
python3 --version

# Try using system Python
/usr/bin/python3 tools/validate-docs-links.py ./docs
```

### Permission Denied on `.sh` file

```bash
chmod +x tools/validate-docs-links.sh
bash tools/validate-docs-links.sh ./docs
```

### Links not being found

Run with verbose output to debug:

```bash
python3 tools/validate-docs-links.py ./docs --verbose 2>&1 | head -100
```

---

## Adding to CI

The workflow is already configured in `.github/workflows/docs-validation.yml`.

To add to additional CI systems:

**GitLab CI:**

```yaml
docs:validate:
  image: python:3.11
  script:
    - python3 tools/validate-docs-links.py ./docs --verbose
```

**Jenkins:**

```groovy
stage('Validate Docs') {
    steps {
        sh 'python3 tools/validate-docs-links.py ./docs --verbose'
    }
}
```

---

## Related Tools

- **markdownlint** — Markdown style linting (installed in GitHub Actions)
- **mdbook** — Documentation site builder (uses link validation)
- **vale** — Prose linting for documentation tone

---

## Future Improvements

Potential enhancements:

- [ ] Cache external link checks
- [ ] Generate link report (HTML/JSON)
- [ ] Suggest fixes for broken links
- [ ] Check image references
- [ ] Validate code examples
- [ ] Check for deprecated links

---

**Last Updated**: February 1, 2026
**Version**: 1.0
